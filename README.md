# RFM-Segmentation

USE RFM_SALES;

/* Now that we have imported the data using table data import wizard in a table named 'sample_sales_data'
 we can start exploring the table */
 
 SELECT * FROM SAMPLE_SALES_DATA LIMIT 10;
 
SELECT COUNT(*) FROM SAMPLE_SALES_DATA;-- 2,823 ROWS
SELECT COUNT(DISTINCT ORDERNUMBER) FROM SAMPLE_SALES_DATA;-- 307

SELECT 
	ORDERNUMBER,
    ORDERLINENUMBER,
    SAMPLE_SALES_DATA.*
FROM SAMPLE_SALES_DATA
ORDER BY 1, 2;

SELECT 
	COUNT(DISTINCT ORDERNUMBER) AS NUMBER_OF_ORDERS,
    SUM(QUANTITYORDERED) AS QTY_ORDERED,
    ROUND(SUM(QUANTITYORDERED)/COUNT(DISTINCT ORDERNUMBER),1) AS AVG_BASKET_SIZE
FROM SAMPLE_SALES_DATA; 


SELECT 
	YEAR_ID AS YEAR,
    MONTH_ID AS MONTH,
	COUNT(DISTINCT ORDERNUMBER) AS NUMBER_OF_ORDERS,
    SUM(QUANTITYORDERED) AS QTY_ORDERED,
    ROUND(SUM(QUANTITYORDERED)/COUNT(DISTINCT ORDERNUMBER),1) AS AVG_BASKET_SIZE
FROM SAMPLE_SALES_DATA
GROUP BY 1, 2
ORDER BY 1, 2; 

-- Year wise aggregation
SELECT 
	YEAR_ID AS YEAR,
	COUNT(DISTINCT ORDERNUMBER) AS NUMBER_OF_ORDERS,
    SUM(QUANTITYORDERED) AS QTY_ORDERED,
    ROUND(SUM(QUANTITYORDERED)/COUNT(DISTINCT ORDERNUMBER),1) AS AVG_BASKET_SIZE
FROM SAMPLE_SALES_DATA
GROUP BY 1
ORDER BY 1; 

-- Now, pivoting the result using CASE WHEN
SELECT 
	MONTH_ID AS MONTH,
	COUNT(DISTINCT CASE WHEN YEAR_ID = 2003 THEN ORDERNUMBER ELSE NULL END) AS NUMBER_OF_ORDERS_2003,
    COUNT(DISTINCT CASE WHEN YEAR_ID = 2004 THEN ORDERNUMBER ELSE NULL END) AS NUMBER_OF_ORDERS_2004,
    COUNT(DISTINCT CASE WHEN YEAR_ID = 2005 THEN ORDERNUMBER ELSE NULL END) AS NUMBER_OF_ORDERS_2005
FROM SAMPLE_SALES_DATA
GROUP BY MONTH_ID
ORDER BY MONTH_ID; 


SELECT 
	MONTH_ID AS MONTH,
	SUM(CASE WHEN YEAR_ID = 2003 THEN QUANTITYORDERED ELSE 0 END) AS QTY_ORDERED_2003,
    SUM(CASE WHEN YEAR_ID = 2004 THEN QUANTITYORDERED ELSE 0 END) AS QTY_ORDERED_2004,
    SUM(CASE WHEN YEAR_ID = 2005 THEN QUANTITYORDERED ELSE 0 END) AS QTY_ORDERED_2005
FROM SAMPLE_SALES_DATA
GROUP BY MONTH_ID
ORDER BY MONTH_ID; 



